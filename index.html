<!DOCTYPE html>
<html>
<head>
<title>Prime Tube</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f0f0f;
  color:white;
}

/* Header */
header{
  background:#1f1f1f;
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

input{
  padding:8px;
  border:none;
  border-radius:4px;
}

button{
  padding:8px 15px;
  background:red;
  border:none;
  color:white;
  border-radius:4px;
  cursor:pointer;
}

#videos{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:15px;
  padding:20px;
}

.video-card{
  background:#1f1f1f;
  padding:10px;
  border-radius:8px;
}

iframe{
  width:100%;
  height:200px;
  border-radius:8px;
}

#loginSection{
  text-align:center;
  margin-top:120px;
}

#welcomeBox{
  padding:15px 20px;
  background:#181818;
  display:flex;
  align-items:center;
  gap:15px;
}

.profile-img{
  width:60px;
  height:60px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid #00ffcc;
}

.avatar-small{
  width:35px;
  height:35px;
  border-radius:50%;
  object-fit:cover;
  cursor:pointer;
}

.glow-btn{
  display:inline-block;
  padding:8px 15px;
  background:#0088cc;
  border-radius:20px;
  text-decoration:none;
  color:white;
  box-shadow:0 0 10px #0088cc;
}

#welcomePopup{
  position:fixed;
  top:20px;
  right:20px;
  background:#111;
  padding:15px 20px;
  border-radius:10px;
  box-shadow:0 0 20px #00ffcc;
  display:none;
  z-index:9999;
}

</style>
</head>

<body>

<div id="loginSection">
  <h2>Prime Tube Login</h2>
  <input type="email" id="email" placeholder="Email"><br><br>
  <input type="password" id="password" placeholder="Password"><br><br>
  <button id="signupBtn">Sign Up</button>
  <button id="loginBtn">Login</button>
</div>

<div id="mainContent" style="display:none;">

<header>
  <h2>Prime Tube</h2>
  <div>
    <input type="text" id="searchInput" placeholder="Search...">
    <button onclick="searchVideos()">Search</button>
    <img id="headerAvatar" class="avatar-small">
    <button id="logoutBtn">Logout</button>
  </div>
</header>

<div id="welcomePopup"></div>
<div id="welcomeBox"></div>
<div id="videos"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword, 
  onAuthStateChanged, 
  signOut,
  updateProfile
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import { 
  getStorage, 
  ref, 
  uploadBytes, 
  getDownloadURL 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyAJ5A3fVLjRCRtO4nyphy7j7NtgEKWYAd8",
  authDomain: "prime-tube-65695.firebaseapp.com",
  projectId: "prime-tube-65695",
  storageBucket: "prime-tube-65695.appspot.com",
  messagingSenderId: "427524700832",
  appId: "1:427524700832:web:3b6a0b8f843514c9bee7c5"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const storage = getStorage(app);

const loginSection = document.getElementById("loginSection");
const mainContent = document.getElementById("mainContent");
const welcomeBox = document.getElementById("welcomeBox");
const headerAvatar = document.getElementById("headerAvatar");
const welcomePopup = document.getElementById("welcomePopup");
const videos = document.getElementById("videos");

document.getElementById("signupBtn").onclick = async () => {
  await createUserWithEmailAndPassword(auth,email.value,password.value);
};

document.getElementById("loginBtn").onclick = async () => {
  await signInWithEmailAndPassword(auth,email.value,password.value);
};

document.getElementById("logoutBtn").onclick = async () => {
  await signOut(auth);
};

onAuthStateChanged(auth,(user)=>{
  if(user){
    loginSection.style.display="none";
    mainContent.style.display="block";
    showWelcome(user);
    loadDefaultVideos();
  }else{
    loginSection.style.display="block";
    mainContent.style.display="none";
  }
});

function showWelcome(user){

  const photo = user.photoURL || "https://i.ibb.co/4pDNDk1/avatar.png";

  headerAvatar.src = photo;

  welcomeBox.innerHTML = `
    <img src="${photo}" class="profile-img">
    <div>
      ðŸ‘‹ Welcome back, <b>${user.email}</b><br>
      <a href="https://t.me/PRIME_X_CHAT2" target="_blank" class="glow-btn">
        ðŸ”¥ Join PRIME X Community
      </a>
    </div>
  `;

  welcomePopup.innerHTML = `
    ðŸ‘‹ Welcome <b>${user.email}</b><br>
    Enjoy unlimited streaming ðŸš€
  `;

  welcomePopup.style.display="block";

  setTimeout(()=>{
    welcomePopup.style.display="none";
  },4000);
}

const YOUTUBE_API_KEY="AIzaSyB7XGItFXkRNsc_X6zmz8UnF5UyIkhL9cw";

async function loadDefaultVideos(){
  searchVideos("trending music");
}

window.searchVideos=async function(query){
  query=query||searchInput.value;
  if(!query)return;

  const res=await fetch(
    `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=12&q=${encodeURIComponent(query)}&key=${YOUTUBE_API_KEY}`
  );

  const data=await res.json();
  videos.innerHTML="";

  if(!data.items){
    videos.innerHTML="<p>API error or limit reached</p>";
    return;
  }

  data.items.forEach(item=>{
    if(!item.id.videoId) return;

    videos.innerHTML+=`
      <div class="video-card">
        <iframe 
          src="https://www.youtube.com/embed/${item.id.videoId}"
          allowfullscreen>
        </iframe>
        <p>${item.snippet.title}</p>
      </div>
    `;
  });
};

</script>

</body>
</html>
